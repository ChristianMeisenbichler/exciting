!
!
! function to compose filename for parallel execution
! REMARK: never call with stringconstat allways call by reference to filetag
!
!
Character (256) Function outfilenamestring (filetag, ik)
      Use modmpi, Only: procs, lastk, firstk, procofk, splittfile
      Use modmain, Only: scrpath, filext, task
      Use modinput
      Implicit None
!external lastk,firstk
!
!character(256):: outfilenamestring
      Character (256), Intent (In) :: filetag
      Integer, Intent (In) :: ik
      Character (256) :: tmp, tmp2, krange, scrpathtmp
      krange = ''
      tmp = ''
      tmp2 = ''
      scrpathtmp = ''
      outfilenamestring = ''
#ifdef MPI
!
!<sag>
      If ((task .Eq. 0) .Or. (task .Eq. 1)) Then
!</sag>
         If ((procs .Gt. 1) .And. splittfile) Then
            Write (tmp, '(I5)') firstk (procofk(ik))
            Write (tmp2, '(I5)') lastk (procofk(ik))
            krange = trim (adjustl(tmp)) // '-' // trim (adjustl(tmp2))
            scrpathtmp = scrpath
         End If
!<sag>
      End If
!</sag>
#endif
      outfilenamestring = trim (scrpathtmp) // trim (filetag) // trim &
     & (krange) // trim (filext)
End Function outfilenamestring
